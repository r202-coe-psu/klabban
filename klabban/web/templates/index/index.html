{% extends "/base/default_page.html" %}
{% import "/components/dialogs.html" as dialog %}

{% block head %}
{{ super() }}
<meta name="description" content="เว็บไซต์สำหรับหาญาติในศูนย์พักพิง">
<link rel="canonical" href="{{ request.url }}">
<meta property="og:type" content="website">
<meta property="og:title" content="{{ config.APP_TITLE }}">
<meta property="og:description" content="เว็บไซต์สำหรับหาญาติในศูนย์พักพิง">
<meta property="og:url" content="{{ request.url }}">
<meta property="og:image" content="https://hakon.psu.ac.th/static/images/logo/diis-logo.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="{{ config.APP_TITLE }}">
<meta name="twitter:description" content="เว็บไซต์สำหรับหาญาติในศูนย์พักพิง">
{% endblock head %}

{% block content %}
<main class="container mx-auto px-4 flex flex-col items-center mt-8 mb-16">
  {# Hero Section #}
  <div class="text-center mb-10">
    {# Main Title #}
    <h1 class="text-5xl md:text-6xl font-bold mb-3 text-gray-800">
      HAKON
    </h1>
    
    {# Subtitle #}
    <p class="text-lg md:text-xl text-gray-600 mb-1">เว็บไซต์สำหรับหาญาติในศูนย์พักพิง</p>
    
    {# English Subtitle #}
    <p class="text-sm text-gray-500">Migrant Family Reunification Platform</p>
  </div>
  {# Warning Message Section #}
  <div class="w-full max-w-5xl mb-6">
    <div class="relative overflow-hidden rounded-xl bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-100 shadow-sm">
      
      {# Content #}
      <div class="relative px-5 py-3 flex items-center justify-center gap-3">
        {# Warning Icon #}
        <div class="flex-shrink-0">
          <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center border border-yellow-200">
            <i class="ph-fill ph-megaphone text-lg text-yellow-500"></i>
          </div>
        </div>
        
        {# Warning Text #}
        <div class="">
          <p class="text-sm font-medium text-yellow-600 leading-relaxed">
            ต้องการตามหาคนหายให้เข้าแจ้งรายชื่อกับพนักงานสอบสวนสถานีตำรวจภูธรจังหวัดสงขลา ที่อาคารเรียนรวมและหอสมุดสุขภาพคณะแพทย์ศาสตร์ มหาวิทยาลัยสงขลานครินทร์ ตั้งแต่เวลา 8.00 น. ถึง 18.00 น.
            <i class="ph ph-map-pin"></i>
            <a class="underline" href="https://maps.app.goo.gl/ictmcUp1JEYXEkZM7">
              คลิกที่นี่เพื่อดูพิกัด</a>
          </p>
        </div>
      </div>
      
      
      <div class="absolute top-0 right-0 w-16 h-16 bg-yellow-100 rounded-full -mr-8 -mt-8 opacity-20"></div>
      <div class="absolute bottom-0 left-0 w-12 h-12 bg-orange-100 rounded-full -ml-6 -mb-6 opacity-20"></div>
    </div>
  </div>
  
  {# Warning Message Section #}
  <div class="w-full max-w-5xl mb-6">
    <div class="relative overflow-hidden rounded-xl bg-gradient-to-r from-red-50 to-orange-50 border border-red-100 shadow-sm">
      
      {# Content #}
      <div class="relative px-5 py-3 flex items-center justify-center gap-3">
        {# Warning Icon #}
        <div class="flex-shrink-0">
          <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center border border-red-200">
            <i class="ph-fill ph-warning text-lg text-red-500"></i>
          </div>
        </div>
        
        {# Warning Text #}
        <div class="text-center">
          <p class="text-sm font-medium text-red-600 leading-relaxed">
            ข้อมูลนี้สำหรับติดตามหาบุคคลสูญหายในสถานการณ์ภัยพิบัติเท่านั้น
            <span class="block sm:inline">และจะลบออกเมื่อสถานการณ์คลี่คลาย</span>
          </p>
        </div>
      </div>
      
      
      <div class="absolute top-0 right-0 w-16 h-16 bg-red-100 rounded-full -mr-8 -mt-8 opacity-20"></div>
      <div class="absolute bottom-0 left-0 w-12 h-12 bg-orange-100 rounded-full -ml-6 -mb-6 opacity-20"></div>
    </div>
  </div>
  
  {# Search Card #}
  <div class="card w-full max-w-5xl bg-white shadow-md border border-gray-200 rounded-2xl mb-8">
    <div class="card-body p-6 md:p-8">
      {# Card Title #}
      <div class="mb-4">
        <h2 class="text-2xl font-semibold text-gray-800 mb-1">ค้นหาผู้อพยพ</h2>
        <p class="text-sm text-gray-500">Search for migrants</p>
      </div>
      
      {# Search Form #}
      <form action="{{ url_for('refugees.index') }}" method="get" class="flex flex-col md:flex-row gap-3 items-stretch md:items-center">
        {# Search Input #}
        <div class="flex-1">
          <input 
            type="text" 
            name="search" 
            id="search" 
            placeholder="ชื่อ - สกุล หรือ ชื่อเล่น / Name or Nickname"
            class="input input-bordered w-full rounded-sm bg-gray-50 border-gray-300 focus:bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 text-base px-5 py-3" 
          />
        </div>

        {# Search Button #}
        <div class="flex gap-2 md:w-auto shrink-0">
          <button 
            type="submit"
            class="btn btn-primary rounded-sm px-6 py-3 w-full md:w-auto font-medium text-base shadow-sm hover:shadow-md transition-all duration-200 flex items-center justify-center gap-2"
          >
            <i class="ph ph-magnifying-glass text-xl"></i>
            <span>ค้นหา / Search</span>
          </button>
          
        </div>
        
      </form>
    </div>
  </div>
  
  <div class="w-full max-w-5xl mb-6">
    <div class="bg-white border border-gray-300 rounded-xl shadow-lg">
      <div class="p-4 md:p-6">
        <div class="flex flex-col items-center text-center gap-4">
          {# Main message section #}
          <div class="flex flex-col lg:flex-row items-center gap-3 lg:gap-4">
            <div class="flex flex-row items-center gap-2">
              <span class="font-medium text-gray-800 text-sm md:text-base">
                หากท่านได้ออกจากศูนย์พักพิง กรุณากดปุ่ม
              </span>
              
              <img 
              src="{{ url_for('static', filename='images/manual/change_status.png') }}"
              alt="change_status"
              class="h-8 w-8 md:h-10 md:w-10 rounded-lg shadow-md flex-shrink-0"
              />
            </div>
          
            <span class="text-gray-700 text-sm md:text-base max-w-md lg:max-w-none">
              หลังสถานะผู้อพยพเพื่อยืนยันการออก หรือทำตามคู่มือได้ที่ 
              <a href="{{ url_for('manuals.index') }}" class="text-blue-600 hover:underline font-medium">คู่มือ</a>
            </span>
          </div>
          
          {# Button section #}
          <div class="w-full max-w-sm">
            <a class="btn btn-error text-white w-full text-sm md:text-base py-3 md:py-4 h-auto min-h-0 rounded-lg shadow-sm hover:shadow-md transition-all duration-200" 
               href="{{ url_for('refugees.create_report', type='not_found') }}">
              <i class="ph ph-flag text-lg md:text-xl"></i>
              <span class="">แจ้งปัญหาระบบ</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  

  {# Section Header #}
  <div class="w-full max-w-5xl mb-6 mt-4 flex flex-col md:flex-row items-center justify-between gap-4">
    <div class="text-center md:text-left">
      <div class="flex items-center gap-3 justify-center md:justify-start mb-1">
        <div class="w-1 h-8 bg-blue-600 rounded-full hidden md:block"></div>
        <h2 class="text-3xl font-bold text-gray-800">รายการศูนย์พักพิง</h2>
      </div>
      <p class="text-gray-500 text-sm md:ml-4">Migrant Shelter List</p>
    </div>
  </div>

  <div class="w-full max-w-5xl">
    <div class="grid {% if refugee_camps|length > 2 %}
      md:grid-cols-3
      {% elif refugee_camps|length > 1 %}
      md:grid-cols-2
      {% else %}
      grid-cols-1
      {% endif %} gap-4">
      {% for refugee_camp in refugee_camps %}
      <div class="card w-full bg-white shadow-sm hover:shadow-xl border border-gray-200 hover:border-blue-200 rounded-2xl transition-all duration-300 group h-full flex flex-col">
        <div class="card-body p-6 flex flex-col h-full">
            {# Header Section #}
            <div class="{% if refugee_camp.description or refugee_camp.contact_info %}mb-4{% else %}mb-3{% endif %}">
                <div class="flex justify-between items-start gap-2 mb-3">
                    <h2 class="card-title text-xl font-bold text-gray-800 group-hover:text-blue-600 transition-colors line-clamp-2">
                      {{ refugee_camp.name }} 
                      {% if refugee_camp.status == 'closed' %} 
                        <span class="text-base font-normal text-gray-500">(ปิดศูนย์พักพิง)</span>
                      {% endif %}

                    </h2>
                    {# Status Indicator #}
                    <span class="relative flex h-3 w-3 mt-1.5 shrink-0">
                      {% if refugee_camp.status == 'active' %}
                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                      {% endif %}
                      <span class="relative inline-flex rounded-full h-3 w-3 {{'bg-green-500' if refugee_camp.status == 'active' else 'bg-red-500' }}"></span>
                    </span>
                </div>
                
                {# Refugee Count Badge #}
                <div class="{% if refugee_camp.description %}mb-4{% else %}mb-0{% endif %}">
                    <div class="inline-flex items-center gap-2 bg-blue-50 text-blue-700 px-3 py-1.5 rounded-lg border border-blue-100 group-hover:bg-blue-100 group-hover:border-blue-200 transition-colors">
                        <i class="ph-fill ph-users text-lg"></i>
                        <span class="font-bold">{{ refugee_camp.refugee_count or 0 | format_number }}</span>
                        <span class="text-sm font-medium">ผู้อพยพ / Migrants</span>
                    </div>
                </div> 

                {# Description #}
                {% if refugee_camp.description %}
                <p class="text-sm text-gray-600 mt-4 line-clamp-3 leading-relaxed">{{ refugee_camp.description }}</p>
                {% endif %}
            </div>

            {# Contact Information #}
            {% if refugee_camp.contact_info %}
            <div class="mb-4 bg-gray-50 rounded-xl border border-gray-100 p-4">
                <div class="flex items-start gap-3 text-sm">
                    <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center shrink-0 text-blue-600">
                        <i class="ph-fill ph-phone text-lg"></i>
                    </div>
                    <div class="pt-1 min-w-0 flex-1">
                        <span class="font-semibold text-gray-700 block text-xs uppercase tracking-wider mb-0.5">Contact</span>
                        <span class="text-gray-800 font-medium wrap-break-word">{{ refugee_camp.contact_info | safe }}</span>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="mb-4 bg-gray-50 rounded-xl border border-gray-100 p-4">
                <div class="flex items-center gap-3 text-sm">
                    <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center shrink-0 text-gray-400">
                        <i class="ph-fill ph-info text-lg"></i>
                    </div>
                    <div class="flex-1">
                        <span class="text-gray-500 text-sm italic">ไม่มีข้อมูลการติดต่อ</span>
                    </div>
                </div>
            </div>
            {% endif %}

            {# Action Buttons #}
            <div class="flex flex-col gap-3 mt-auto {% if not refugee_camp.contact_info %}pt-4{% else %}pt-2{% endif %}">
                {% if refugee_camp.other_link or refugee_camp.location_url %}
                <div class="grid {% if refugee_camp.other_link and refugee_camp.location_url %}grid-cols-2{% else %}grid-cols-1{% endif %} gap-3 w-full">
                    {% if refugee_camp.other_link %}
                    <a href="{{ refugee_camp.other_link }}" target="_blank" class="btn btn-outline btn-sm h-10 font-normal rounded-lg border-gray-300 hover:bg-gray-50 hover:border-gray-400 text-gray-600 hover:text-gray-800 transition-colors">
                        <span class="material-symbols-outlined text-lg">open_in_new</span>
                        <span class="hidden sm:inline">ข้อมูลเพิ่มเติม</span>
                        <span class="sm:hidden">ข้อมูล</span>
                    </a>
                    {% endif %}
                    {% if refugee_camp.location_url %}
                    <a href="{{ refugee_camp.location_url }}" target="_blank" class="btn btn-outline btn-sm h-10 font-normal rounded-lg border-gray-300 hover:bg-gray-50 hover:border-gray-400 text-gray-600 hover:text-gray-800 transition-colors">
                        <span class="material-symbols-outlined text-lg">location_on</span>
                        <span>แผนที่</span>
                    </a>
                    {% endif %}
                </div>
                {% endif %}
                <a href="{{ url_for('refugees.index', refugee_camp=refugee_camp.id) }}" class="btn btn-primary w-full text-white font-semibold text-base h-12 rounded-xl shadow-sm hover:shadow-md transition-all">
                    <i class="ph-bold ph-person text-xl"></i>
                    <span class="hidden sm:inline">ดูรายชื่อผู้อพยพ / View List</span>
                    <span class="sm:hidden">ดูรายชื่อ</span>
                </a>
            </div>
        </div>
      </div>
      {% endfor %}
      {% if refugee_camps|length == 0 %}
      <div class="col-span-3 text-center py-10 text-gray-500">
        ไม่มีข้อมูลศูนย์พักพิง
      </div>
      {% endif %}
    </div>
  </div>
</main>

{# Bottom sticky privacy notice button - responsive design #}
<div id="privacy-sticky-button" class="fixed bottom-0 left-0 right-0 z-50 bg-blue-600 border-t border-blue-700 shadow-lg">
  <div class="max-w-7xl mx-auto px-10 sm:px-10 py-3 sm:py-4">
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4">
      {# Left side - Content #}
      <div class="flex items-start sm:items-center gap-2 sm:gap-3 text-white flex-1 min-w-0">
        <div class="flex items-center gap-2 flex-1 min-w-0">
          <i class="ph ph-shield-check text-lg sm:text-xl shrink-0"></i>
          <div class="min-w-0 flex-1">
            <h3 class="font-semibold text-xs sm:text-sm leading-tight">นโยบายความเป็นส่วนตัว</h3>
            <p class="text-xs text-blue-100 leading-tight mt-0.5 hidden sm:block">เราใช้ข้อมูลของคุณเพื่อการช่วยเหลือในสถานการณ์ฉุกเฉิน</p>
            <p class="text-xs text-blue-100 leading-tight mt-0.5 sm:hidden">ข้อมูลสำหรับสถานการณ์ฉุกเฉิน</p>
          </div>
        </div>
      </div>
      
      {# Right side - Action buttons #}
      <div class="flex items-center gap-2 sm:gap-3 w-full sm:w-auto shrink-0">
        <button onclick="openPrivacyNoticeSticky()" 
                class="bg-white text-blue-600 px-3 sm:px-4 py-1.5 sm:py-2 rounded-md sm:rounded-lg text-xs sm:text-sm font-medium hover:bg-gray-50 transition-colors flex-1 sm:flex-none">
          <span class="sm:hidden">ข้อมูลเพิ่มเติม</span>
          <span class="hidden sm:inline">ข้อมูลเพิ่มเติม</span>
        </button>
        <button onclick="dismissPrivacyNotice()" 
                class="text-white hover:text-gray-200 transition-colors p-1.5 sm:p-2 shrink-0"
                aria-label="Close">
          <i class="ph ph-x text-base sm:text-lg"></i>
        </button>
      </div>
    </div>
  </div>
</div>

{# Privacy Notice Dialog for sticky button #}
{{ dialog.PrivacyNoticeDPOThai(id="privacy_sticky_modal") }}

<script>
document.addEventListener('DOMContentLoaded', function() {
  const stickyButton = document.getElementById('privacy-sticky-button');
  
  // Function to detect mobile device
  function isMobileDevice() {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
           window.innerWidth <= 768;
  }
  
  // Function to hide sticky button
  function hidePrivacyButton() {
    if (stickyButton) {
      stickyButton.classList.add('animate-slide-down');
      setTimeout(() => {
        stickyButton.classList.add('hidden');
      }, 300);
    }
  }
  
  // Function to dismiss privacy notice
  window.dismissPrivacyNotice = function() {
    hidePrivacyButton();
  };
  
  // Function to open privacy notice from sticky button
  window.openPrivacyNoticeSticky = function() {
    // Check if mobile device
    if (isMobileDevice()) {
      // Redirect to PDF on mobile
      window.open("{{ url_for('static', filename='files/privacy-notice.pdf') }}", '_blank');
      hidePrivacyButton();
    } else {
      // Show modal on desktop
      document.getElementById('privacy_sticky_modal').showModal();
    }
  };
  
  // Hide banner when any of the modal buttons are clicked
  const stickyModal = document.getElementById('privacy_sticky_modal');
  if (stickyModal) {
    stickyModal.addEventListener('click', function(e) {
      if (e.target.textContent.includes('รับทราบ') || 
          e.target.textContent.includes('ปิด') ||
          e.target.textContent === '✕') {
        hidePrivacyButton();
      }
    });
  }
});
</script>

<style>
@keyframes slide-down {
  from {
    transform: translateY(0);
  }
  to {
    transform: translateY(100%);
  }
}

.animate-slide-down {
  animation: slide-down 0.3s ease-out forwards;
}

/* Additional responsive styles */
@media (max-width: 640px) {
  #privacy-sticky-button {
    font-size: 14px;
  }
  
  #privacy-sticky-button .ph {
    font-size: 16px !important;
  }
}
</style>
{% endblock %}
