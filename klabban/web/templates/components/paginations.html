{% macro render_pagination(pagination, endpoint, key_page='page', kwargs={}) %}
{% if pagination.pages > 1 %}
<div class="flex items-center justify-between mt-6">
  <div class="text-sm text-gray-700">
    แสดง <span class="font-medium">{{ (pagination.page - 1) * pagination.per_page + 1 }}</span> 
    ถึง <span class="font-medium">{{ (pagination.page - 1) * pagination.per_page + pagination.items|length }}</span> 
    จาก <span class="font-medium">{{ pagination.total }}</span> รายการ
  </div>
  
  <div class="flex">
    <nav class="join" aria-label="Pagination">
      <!-- Previous Page Button -->
      {% if pagination.has_prev %}
        {% set prev_args = kwargs.copy() %}
        {% set _ = prev_args.update({key_page: pagination.prev_num}) %}
        <a href="{{ url_for(endpoint, **prev_args) }}" 
           class="btn btn-sm join-item btn-outline">
          <i class="ph ph-caret-left"></i>
          ก่อนหน้า
        </a>
      {% else %}
        <button class="btn btn-sm join-item btn-disabled">
          <i class="ph ph-caret-left"></i>
          ก่อนหน้า
        </button>
      {% endif %}

      <!-- Page Numbers -->
      {% set start_page = [1, pagination.page - 2]|max %}
      {% set end_page = [pagination.pages, pagination.page + 2]|min %}
      
      <!-- First page if not in range -->
      {% if start_page > 1 %}
        {% set first_args = kwargs.copy() %}
        {% set _ = first_args.update({key_page: 1}) %}
        <a href="{{ url_for(endpoint, **first_args) }}" 
           class="btn btn-sm join-item btn-outline">1</a>
        {% if start_page > 2 %}
          <span class="btn btn-sm join-item btn-disabled">...</span>
        {% endif %}
      {% endif %}

      <!-- Page range -->
      {% for page_num in range(start_page, end_page + 1) %}
        {% if page_num == pagination.page %}
          <span class="btn btn-sm join-item btn-active">{{ page_num }}</span>
        {% else %}
          {% set page_args = kwargs.copy() %}
          {% set _ = page_args.update({key_page: page_num}) %}
          <a href="{{ url_for(endpoint, **page_args) }}" 
             class="btn btn-sm join-item btn-outline">{{ page_num }}</a>
        {% endif %}
      {% endfor %}

      <!-- Last page if not in range -->
      {% if end_page < pagination.pages %}
        {% if end_page < pagination.pages - 1 %}
          <span class="btn btn-sm join-item btn-disabled">...</span>
        {% endif %}
        {% set last_args = kwargs.copy() %}
        {% set _ = last_args.update({key_page: pagination.pages}) %}
        <a href="{{ url_for(endpoint, **last_args) }}" 
           class="btn btn-sm join-item btn-outline">{{ pagination.pages }}</a>
      {% endif %}

      <!-- Next Page Button -->
      {% if pagination.has_next %}
        {% set next_args = kwargs.copy() %}
        {% set _ = next_args.update({key_page: pagination.next_num}) %}
        <a href="{{ url_for(endpoint, **next_args) }}" 
           class="btn btn-sm join-item btn-outline">
          ถัดไป
          <i class="ph ph-caret-right"></i>
        </a>
      {% else %}
        <button class="btn btn-sm join-item btn-disabled">
          ถัดไป
          <i class="ph ph-caret-right"></i>
        </button>
      {% endif %}
    </nav>
  </div>
</div>
{% endif %}
{% endmacro %}

{% macro render_simple_pagination(pagination, endpoint, key_page='page', kwargs={}) %}
{% if pagination.pages > 1 %}
<div class="flex items-center justify-center mt-6">
  <div class="join">
    <!-- Previous Page Button -->
    {% if pagination.has_prev %}
      {% set prev_args = kwargs.copy() %}
      {% set _ = prev_args.update({key_page: pagination.prev_num}) %}
      <a href="{{ url_for(endpoint, **prev_args) }}" 
         class="btn btn-sm join-item">
        <i class="ph ph-caret-left"></i>
      </a>
    {% else %}
      <button class="btn btn-sm join-item btn-disabled">
        <i class="ph ph-caret-left"></i>
      </button>
    {% endif %}

    <!-- Current Page Info -->
    <span class="btn btn-sm join-item btn-active">
      {{ pagination.page }} / {{ pagination.pages }}
    </span>

    <!-- Next Page Button -->
    {% if pagination.has_next %}
      {% set next_args = kwargs.copy() %}
      {% set _ = next_args.update({key_page: pagination.next_num}) %}
      <a href="{{ url_for(endpoint, **next_args) }}" 
         class="btn btn-sm join-item">
        <i class="ph ph-caret-right"></i>
      </a>
    {% else %}
      <button class="btn btn-sm join-item btn-disabled">
        <i class="ph ph-caret-right"></i>
      </button>
    {% endif %}
  </div>
</div>
{% endif %}
{% endmacro %}

{% macro render_pagination_with_size(pagination, endpoint, key_page='page', key_per_page='per_page', kwargs={}) %}
<div class="flex flex-col sm:flex-row items-center justify-between mt-6 gap-4">
  <div class="flex items-center gap-2">
    <span class="text-sm text-gray-700">แสดงต่อหน้า:</span>
    <select class="select select-sm select-bordered" 
            onchange="window.location.href = updateUrlParam('{{ key_per_page }}', this.value)">
      {% for size in [10, 20, 50, 100] %}
        <option value="{{ size }}" {% if pagination.per_page == size %}selected{% endif %}>
          {{ size }}
        </option>
      {% endfor %}
    </select>
  </div>

  <div class="text-sm text-gray-700">
    แสดง <span class="font-medium">{{ (pagination.page - 1) * pagination.per_page + 1 }}</span> 
    ถึง <span class="font-medium">{{ (pagination.page - 1) * pagination.per_page + pagination.items|length }}</span> 
    จาก <span class="font-medium">{{ pagination.total }}</span> รายการ
  </div>
  
  {% if pagination.pages > 1 %}
  <div class="join">
    {% if pagination.has_prev %}
      {% set prev_args = kwargs.copy() %}
      {% set _ = prev_args.update({key_page: pagination.prev_num}) %}
      <a href="{{ url_for(endpoint, **prev_args) }}" 
         class="btn btn-sm join-item btn-outline">
        <i class="ph ph-caret-left"></i>
        ก่อนหน้า
      </a>
    {% else %}
      <button class="btn btn-sm join-item btn-disabled">
        <i class="ph ph-caret-left"></i>
        ก่อนหน้า
      </button>
    {% endif %}

    {% set start_page = [1, pagination.page - 1]|max %}
    {% set end_page = [pagination.pages, pagination.page + 1]|min %}
    
    {% for page_num in range(start_page, end_page + 1) %}
      {% if page_num == pagination.page %}
        <span class="btn btn-sm join-item btn-active">{{ page_num }}</span>
      {% else %}
        {% set page_args = kwargs.copy() %}
        {% set _ = page_args.update({key_page: page_num}) %}
        <a href="{{ url_for(endpoint, **page_args) }}" 
           class="btn btn-sm join-item btn-outline">{{ page_num }}</a>
      {% endif %}
    {% endfor %}

    {% if pagination.has_next %}
      {% set next_args = kwargs.copy() %}
      {% set _ = next_args.update({key_page: pagination.next_num}) %}
      <a href="{{ url_for(endpoint, **next_args) }}" 
         class="btn btn-sm join-item btn-outline">
        ถัดไป
        <i class="ph ph-caret-right"></i>
      </a>
    {% else %}
      <button class="btn btn-sm join-item btn-disabled">
        ถัดไป
        <i class="ph ph-caret-right"></i>
      </button>
    {% endif %}
  </div>
  {% endif %}
</div>

<script>
function updateUrlParam(param, value) {
  const url = new URL(window.location);
  url.searchParams.set(param, value);
  url.searchParams.set('{{ key_page }}', 1); 
  return url.toString();
}
</script>
{% endmacro %}
